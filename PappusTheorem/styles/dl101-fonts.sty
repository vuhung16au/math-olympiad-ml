\ProvidesPackage{dl101-fonts}[2025/10/20 DL101 fonts and emoji]
\RequirePackage{iftex}
\ifPDFTeX
  \RequirePackage[utf8]{inputenc}
  \RequirePackage[T1]{fontenc}
  \RequirePackage{lmodern}
  \RequirePackage{CJKutf8}
\else
  \RequirePackage{fontspec}
  \defaultfontfeatures{Ligatures=TeX}
  % Platform-specific font setup
  % Check if running in Docker (Ubuntu) by looking for /etc/os-release
  \IfFileExists{/etc/os-release}{%
    % Running in Docker/Ubuntu - use Liberation fonts
    \setmainfont{Liberation Serif}
    \setsansfont{Liberation Sans}
    \setmonofont{Liberation Mono}
  }{%
    % Running on Mac - use system fonts
    \setmainfont{Times New Roman}
    \setsansfont{Arial}
    \setmonofont{Courier New}
  }
  \ifXeTeX
    \RequirePackage{xeCJK}
    \setCJKmainfont{PingFang SC}
    \setCJKsansfont{PingFang SC}
    \setCJKmonofont{PingFang SC}
  \fi
  \ifLuaTeX
    \RequirePackage{luatexja}
    \RequirePackage{luatexja-fontspec}
    \IfFontExistsTF{PingFang SC}{%
      \setmainjfont{PingFang SC}
      \setsansjfont{PingFang SC}
      \setmonojfont{PingFang SC}
    }{%
      \setmainjfont{HaranoAjiMincho}
      \setsansjfont{HaranoAjiGothic}
      \setmonojfont{HaranoAjiGothic}
    }
  \fi
  % Emoji and difficulty helpers
  \RequirePackage{newunicodechar}
  \IfFontExistsTF{Apple Color Emoji}{%
    \newfontfamily\emojifont{Apple Color Emoji}[Renderer=Harfbuzz,Scale=MatchUppercase]
  }{%
    \IfFontExistsTF{Noto Color Emoji}{%
      \newfontfamily\emojifont{Noto Color Emoji}[Renderer=Harfbuzz,Scale=MatchUppercase]
    }{%
      \IfFontExistsTF{Symbola}{%
        \newfontfamily\emojifont{Symbola}[Scale=MatchUppercase]
      }{%
        \newfontfamily\emojifont{Liberation Sans}[Scale=MatchUppercase]
      }
    }}
  \newcommand{\emoji}[1]{{\emojifont #1}}
  % Handle variation selector
  \newunicodechar{Ô∏è}{}
  % Map common emojis with better fallbacks - use direct font switching
  \newunicodechar{üí´}{{\emojifont üí´}}
  \newunicodechar{‚≠ê}{{\emojifont ‚≠ê}}
  \newunicodechar{üåü}{{\emojifont üåü}}
  % Additional emoji mappings for better coverage
  \newunicodechar{üéØ}{{\emojifont üéØ}}
  
  % Alternative Unicode characters that work better with CJK fonts
  \newunicodechar{‚òÖ}{{\emojifont ‚òÖ}}
  \newunicodechar{‚òÜ}{{\emojifont ‚òÜ}}
  \newunicodechar{‚óè}{{\emojifont ‚óè}}
  \newunicodechar{‚óÜ}{{\emojifont ‚óÜ}}
\fi

% Difficulty inline helpers (mirroring main.tex)
\newcommand{\difficultyBeginner}{\emoji{‚óè}}
\newcommand{\difficultyIntermediate}{\emoji{‚óÜ}}
\newcommand{\difficultyAdvanced}{\emoji{‚òÖ}}
\newcommand{\difficultyInlineBeginner}{\texorpdfstring{\,\difficultyBeginner}{ [beginner] }}
\newcommand{\difficultyInlineIntermediate}{\texorpdfstring{\,\difficultyIntermediate}{ [intermediate] }}
\newcommand{\difficultyInlineAdvanced}{\texorpdfstring{\,\difficultyAdvanced}{ [advanced] }}
\newcommand{\difficultyInlineOther}[1]{\texorpdfstring{\,\textbf{[#1]}}{ [#1] }}
\newcommand{\difficulty}[1]{}
\newcommand{\difficultyInline}[1]{%
  \ifstrequal{#1}{beginner}{\difficultyInlineBeginner}{%
  \ifstrequal{#1}{intermediate}{\difficultyInlineIntermediate}{%
  \ifstrequal{#1}{advanced}{\difficultyInlineAdvanced}{\difficultyInlineOther{#1}}}}}


